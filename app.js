var http = require('http');

//////////////////////////////////////////////////////////////////////////////////////////////
// Initialize server
//////////////////////////////////////////////////////////////////////////////////////////////

var app = require('./src/server/app.js');

server = http.createServer(app).listen(config.server.localport).on('listening', function() {});

//////////////////////////////////////////////////////////////////////////////////////////////
// Initialize websockets
//////////////////////////////////////////////////////////////////////////////////////////////

global.io = require('socket.io').listen(server).sockets;
io.on('connection', function(socket) {

    socket.on('join', function(room) {

        // can only be in one room at a time
        socket.rooms.forEach(function(room) {
            socket.leave(room);
        });

        socket.join(room);
    });
});
