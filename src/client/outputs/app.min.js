"use strict";function ResultSet(){this.loaded=!1,this.loading=!0}var module=angular.module("app",["ninja.config","ninja.filters","ui.utils","ui.router","ui.bootstrap","infinite-scroll","ngSanitize","angulartics","angulartics.google.analytics"]),filters=angular.module("ninja.filters",[]);angular.element(document).ready(function(){angular.bootstrap(document,["app"])}),module.config(["$stateProvider","$urlRouterProvider","$locationProvider","$logProvider","$configProvider","$analyticsProvider",function(e,t,n,r,s,o){e.state("home",{url:"/",templateUrl:"/templates/home.html",controller:"HomeCtrl"}).state("repo",{"abstract":!0,url:"/:user/:repo",template:"<section ui-view></section>",resolve:{repo:["$rootScope","$stateParams","$HUBService",function(e,t,n){return n.call("repos","get",{user:t.user,repo:t.repo})}]}}).state("repo.master",{url:"",templateUrl:"/templates/repo.html",controller:"RepoCtrl",resolve:{repo:["repo",function(e){return e}]}}).state("repo.settings",{url:"/settings",templateUrl:"/templates/settings.html",controller:"SettingsCtrl",resolve:{repo:["repo",function(e){return e}]}}).state("repo.pull",{"abstract":!0,url:"/pull/:number",templateUrl:"/templates/pull.html",controller:"PullCtrl",resolve:{repo:["repo",function(e){return e}],pull:["$stateParams","$HUBService",function(e,t){return t.wrap("pullRequests","get",{user:e.user,repo:e.repo,number:e.number})}]}}).state("repo.pull.issue",{"abstract":!0,templateUrl:"/templates/sidebar.html"}).state("repo.pull.issue.master",{url:"",templateUrl:"/templates/issue/list.html",controller:"IssueListCtrl"}).state("repo.pull.issue.detail",{url:"/:issue",templateUrl:"/templates/issue/detail.html",controller:"IssueDetailCtrl",resolve:{repo:["repo",function(e){return e}],issue:["$HUBService","$stateParams",function(e,t){return e.call("issues","getRepoIssue",{user:t.user,repo:t.repo,number:t.issue})}]}}).state("error",{templateUrl:"/templates/error/not-found.html"}),t.otherwise("/"),n.html5Mode(!0),o.firstPageview(!0),o.withAutoBase(!0),r.debugEnabled(s.log)}]).run(["$config","$rootScope","$state","$stateParams",function(e,t,n,r){t.$state=n,t.$stateParams=r,e.get(function(e){t.$config=e,e.gacode&&ga("create",e.gacode,"auto")})}]),ResultSet.prototype.set=function(e,t){this.loaded=!0,this.loading=!1,this.error=e,this.affix=t,this.value=this.value instanceof Array&&t instanceof Array?this.value.concat(t):t},module.factory("$RAW",["$http",function(e){return{call:function(t,n,r,s){var o=new Date;return e.post("/api/"+t+"/"+n,r).success(function(e){try{e=JSON.parse(e)}catch(t){}s(null,e,new Date-o)}).error(function(e){s(e,null,new Date-o)})}}}]),module.factory("$RPC",["$RAW","$log",function(e,t){return{call:function(n,r,s,o){var u=new ResultSet;return e.call(n,r,s,function(e,a){u.set(e,a),t.debug("$RPC",n,r,s,u,u.error),"function"==typeof o&&o(u.error,u)}),u}}}]),module.factory("$HUB",["$RAW","$log",function(e,t){var n=function(r,s,o,u){return e.call("github",r,o,function(e,a){var i=a?a.data:null,l=a?a.meta:null;s.set(e,i),l&&(s.meta=l,s.hasMore=l.hasMore,s.getMore=l.hasMore?function(){s.loaded=!1,s.loading=!0,o.arg.page=o.arg.page+1||2,n(r,s,o,u)}:null),t.debug("$HUB",o,s,s.error),"function"==typeof u&&u(s.error,s)}),s};return{call:function(e,t,r,s){return n("call",new ResultSet,{obj:e,fun:t,arg:r},s)},wrap:function(e,t,r,s){return n("wrap",new ResultSet,{obj:e,fun:t,arg:r},s)}}}]),module.factory("$HUBService",["$q","$HUB",function(e,t){var n=function(n,r,s,o,u,a){var i=e.defer();return t[n](r,s,o,function(e,t){return"function"==typeof u&&u(e,t),(!e||a)&&i.resolve(t),i.reject()}),i.promise};return{call:function(e,t,r,s,o){return n("call",e,t,r,s,o)},wrap:function(e,t,r,s,o){return n("wrap",e,t,r,s,o)}}}]),module.factory("$RPCService",["$q","$RPC",function(e,t){return{call:function(n,r,s,o,u){var a=e.defer();return t.call(n,r,s,function(e,t){return"function"==typeof o&&o(e,t),(!e||u)&&a.resolve(t),a.reject()}),a.promise}}}]),module.controller("HomeCtrl",["$rootScope","$scope","$state","$stateParams","$HUB","$RPC",function(e,t,n,r,s,o){t.repos=[],t.results=[],t.hasRepos=!0,o.call("user","get",{},function(e,n){e||(t.hasRepos=!!n.value.repos.length,n.value.repos.forEach(function(e){s.call("repos","one",{id:e},function(e,n){e||(n.value.ninja=!0,t.repos.push(n.value))})}))}),t.add=function(e){o.call("user","addRepo",{user:e.owner.login,repo:e.name,repo_uuid:e.id},function(n){t.active=null,t.hasRepos=!0,!n&&t.repos.indexOf(e)<0&&(e.ninja=!0,e.adddate=-new Date,t.repos.push(e),t.reset())})},t.remove=function(e){o.call("user","rmvRepo",{user:e.owner.login,repo:e.name,repo_uuid:e.id},function(t){t||(console.log(e),e.ninja=!1)})},t.search=function(){t.results=[];var e=t.query.split("/");e=(e[1]||"")+"+in:name+fork:true+user:"+e[0],t.searching=s.wrap("search","repos",{q:e},function(e,n){e||(t.results=n.value)})},t.reset=function(){t.query=null,t.results=[]}}]),module.controller("PullCtrl",["$scope","$rootScope","$state","$stateParams","$modal","$filter","$HUB","$RPC","Pull","Issue","Comment","File","repo","pull","socket","$timeout",function(e,t,n,r,s,o,u,a,i,l,c,p,f,m,d,h){e.state="open",e.repo=f.value,e.sha=null,e.pull=i.milestone(m.value)&&i.render(m.value)&&i.stars(m.value,!0),e.reference={selection:{},issues:null},e.status=u.call("statuses","getCombined",{user:r.user,repo:r.repo,sha:e.pull.head.sha}),e.reposettings=a.call("repo","get",{repo_uuid:f.value.id}),e.comments=u.call("issues","getComments",{user:r.user,repo:r.repo,number:r.number},function(e,t){e||t.affix.forEach(function(e){e=c.render(e)})}),e.open=e.pull.milestone?u.call("issues","repoIssues",{user:r.user,repo:r.repo,state:"open",milestone:e.pull.milestone.number},function(e,t){t.value=t.value||[],e||t.affix.forEach(function(e){e=l.parse(e)})}):{value:[]},e.closed=e.pull.milestone?u.call("issues","repoIssues",{user:r.user,repo:r.repo,state:"closed",milestone:e.pull.milestone?e.pull.milestone.number:null},function(e,t){t.value=t.value||[],e||t.affix.forEach(function(e){e=l.parse(e)})}):{value:[]},e.getStarText=function(){if(e.pull.stars&&e.reposettings.value){var t=e.pull.stars.length,n=e.reposettings.value.threshold;return n>t?"Pull Request needs "+o("pluralize")(n-t,"more ninja star"):"No more ninja stars needed"}},e.compComm=function(t,n){n=n||e.pull.head.sha,t=t!==n?t:e.pull.base.sha,(e.base!==t||e.head!==n)&&u.wrap("repos","compareCommits",{user:r.user,repo:r.repo,base:t,head:n},function(r,s){r||(e.base=t,e.head=n,e.files=p.getFileTypes(s.value.files))})},e.setStar=function(){var t=e.pull.star?"rmv":"set";a.call("star",t,{repo:r.repo,user:r.user,sha:e.pull.head.sha,number:e.pull.number,repo_uuid:e.pull.base.repo.id})},e.getPullRequest=function(){u.wrap("pullRequests","get",{user:r.user,repo:r.repo,number:r.number},function(t,n){t||(e.pull.head.sha!==n.value.head.sha&&e.compComm(e.base||e.pull.base.sha,n.value.head.sha),e.pull=i.milestone(n.value)&&i.render(n.value)&&i.stars(n.value,!0))})},e.createIssue=function(){e.title&&(e.creatingIssue=!0,a.call("issue","add",{user:r.user,repo:r.repo,sha:e.pull.head.sha,number:r.number,repo_uuid:e.pull.base.repo.id,title:e.title,body:e.description||"",reference:e.reference.selection.ref},function(t,r){t||n.go("repo.pull.issue.detail",{issue:r.value.number}).then(function(){e.show=null,e.title=null,e.description=null,e.reference.selection={},e.creatingIssue=!1})}))},e.addComment=function(){e.comment&&(e.commenting=u.wrap("issues","createComment",{user:r.user,repo:r.repo,number:r.number,body:e.comment},function(t){t||(e.comment=null)}))},e.$watch("reference.selection",function(t,n){!t.ref||n.ref||e.show||(e.highlight=!0,h(function(){e.highlight=!1},1e3))}),e.badge=function(){s.open({templateUrl:"/modals/templates/badge.html",controller:"BadgeCtrl"})},d.on(r.user+":"+r.repo+":status",function(t){e.pull.head.sha===t.sha&&u.call("statuses","getCombined",{user:r.user,repo:r.repo,sha:e.pull.head.sha},function(t,n){t||(e.status.value=n.value)})}),d.on(r.user+":"+r.repo+":pull_request",function(t){e.pull.number===t.number&&(("starred"===t.action||"unstarred"===t.action)&&(e.pull=i.stars(e.pull,!0)),("closed"===t.action||"reopened"===t.action||"synchronize"===t.action)&&e.getPullRequest())}),d.on(r.user+":"+r.repo+":issue_comment",function(t){e.pull.number===t.number&&"created"===t.action&&u.call("issues","getComment",{user:r.user,repo:r.repo,id:t.id},function(t,n){t||e.comments.value.push(c.render(n.value))})}),d.on(r.user+":"+r.repo+":issues",function(t){var n,s;if("opened"===t.action&&e.pull.number===t.pull&&u.call("issues","getRepoIssue",{user:r.user,repo:r.repo,number:t.number},function(t,n){t||(e.open.value.unshift(l.parse(n.value)),e.pull.milestone=n.value.milestone,e.pull=i.milestone(e.pull))}),"closed"===t.action&&e.pull.number===t.pull)for(n=0;n<e.open.value.length;n++)e.open.value[n].number===t.number&&(s=e.open.value[n],s.state="closed",e.open.value.splice(n,1),e.closed.value.unshift(s)),e.pull.milestone&&(e.pull.milestone.open_issues--,e.pull.milestone.closed_issues++);if("reopened"===t.action&&e.pull.number===t.pull)for(n=0;n<e.closed.value.length;n++)e.closed.value[n].number===t.number&&(s=e.closed.value[n],s.state="open",e.closed.value.splice(n,1),e.open.value.unshift(s)),e.pull.milestone&&(e.pull.milestone.open_issues++,e.pull.milestone.closed_issues--)})}]),module.controller("RepoCtrl",["$scope","$stateParams","$modal","$timeout","$HUB","$RPC","repo","socket","Pull",function(e,t,n,r,s,o,u,a,i){e.repo=u,e.type="open";var l=function(e){e.status=s.call("statuses","getCombined",{user:t.user,repo:t.repo,sha:e.head.sha})};e.open=s.wrap("pullRequests","getAll",{user:t.user,repo:t.repo,state:"open",per_page:10},function(e,t){e||t.affix.forEach(function(e){e=i.milestone(e)&&i.stars(e)&&i.commentsCount(e),l(e)})}),e.closed=s.wrap("pullRequests","getAll",{user:t.user,repo:t.repo,state:"closed",per_page:10},function(e,t){e||t.affix.forEach(function(e){e=i.milestone(e)&&i.stars(e)&&i.commentsCount(e),l(e)})}),e.collaborators=s.wrap("repos","getCollaborators",{user:t.user,repo:t.repo}),a.on(t.user+":"+t.repo+":pull_request",function(n){"opened"===n.action&&s.wrap("pullRequests","get",{user:t.user,repo:t.repo,number:n.number},function(t,n){t||(n=i.milestone(n.value)&&i.stars(n.value)&&i.commentsCount(n.value),e.open.value.unshift(n))})}),e.badge=function(){n.open({templateUrl:"/modals/templates/badge.html",controller:"BadgeCtrl"})},e.invite=function(e,n){e.invite=o.call("invitation","invite",{user:t.user,repo:t.repo,invitee:e.login,email:n})};var c=function(e){return e.status.value.statuses[0].description},p=function(e){var t=0;return e.status.value.statuses.forEach(function(e){"success"===e.state&&t++}),t+" / "+e.status.value.total_count+" checks OK"};e.statusTooltip=function(e){if(e.status&&e.status.value){if(1===e.status.value.total_count)return c(e);if(e.status.value.total_count>1)return p(e)}},e.getStarUsers=function(e){return e.stars&&e.stars.length?e.stars.slice(0,3).map(function(e){return e.name}).join(", ")+(e.stars.length>3?" and "+(e.stars.length-3)+" others starred":" starred"):"No stars"}}]),module.controller("RootCtrl",["$rootScope","$scope","$stateParams","$state","$HUB","$RPC",function(e,t,n,r,s,o){e.user=s.call("user","get",{}),e.$on("$stateChangeSuccess",function(e,r,u,a,i){return n.user&&n.repo?void((u.user!==i.user||u.repo!==i.repo)&&s.call("repos","get",{user:n.user,repo:n.repo},function(e,r){!e&&r.value.permissions.admin&&(t.hook=o.call("webhook","get",{user:n.user,repo:n.repo}))})):void(t.hook={})}),e.$on("$stateChangeError",function(){r.go("error")}),t.createWebhook=function(){t.creating=o.call("webhook","create",{user:n.user,repo:n.repo,user_uuid:e.user.value.id},function(e,n){e||(t.hook=n,t.created=!0)})}}]),module.controller("SettingsCtrl",["$scope","$stateParams","$HUB","$RPC","$modal","repo",function(e,t,n,r,s,o){e.repo=o,e.settings=r.call("settings","get",{repo_uuid:o.value.id}),e.threshold=1,e.comment=!0,e.reposettings=r.call("repo","get",{repo_uuid:o.value.id}),e.setNotifications=function(){r.call("settings","setNotifications",{repo_uuid:o.value.id,notifications:e.settings.value.notifications},function(t,n){t||(e.settings.value.notifications=n.value.notifications)})},e.setWatched=function(t){r.call("settings","setWatched",{repo_uuid:o.value.id,watched:t},function(t,n){t||(e.newWatch="",e.settings=n)})},e.addWatch=function(){var t=e.settings.value.watched;t.unshift(e.newWatch),e.setWatched(t)},e.removeWatch=function(t){var n=e.settings.value.watched;n.splice(n.indexOf(t),1),e.setWatched(n)},e.changeThreshold=function(){r.call("repo","setThreshold",{repo_uuid:o.value.id,threshold:e.reposettings.value.threshold},function(t,n){t||(e.reposettings.value.threshold=n.value.threshold)})},e.toggleComments=function(){r.call("repo","setComment",{repo_uuid:o.value.id,comment:e.reposettings.value.comment},function(t,n){t||(e.reposettings.value.comment=n.value.comment)})}}]),module.directive("browser",["$stateParams","$HUB","$RPC","File",function(e,t,n,r){return{restrict:"E",templateUrl:"/directives/templates/browser.html",scope:{sha:"=",issues:"=",selection:"=",refIssues:"="},link:function(n){n.$watch("sha",function(s){s&&(n.stack=[],n.path=[],t.call("gitdata","getTree",{user:e.user,repo:e.repo,sha:s},function(e,t){e||(n.tree=r.getTreeTypes(t.value))}))}),n.up=function(){n.stack.length&&(n.file=null,n.path.pop(),n.tree=n.stack.pop())},n.down=function(s){"tree"===s.type?t.call("gitdata","getTree",{user:e.user,repo:e.repo,sha:s.sha},function(e,t){e||(n.path.push(s.path),n.stack.push(n.tree),n.tree=r.getTreeTypes(t.value))}):t.wrap("gitdata","getBlob",{user:e.user,repo:e.repo,sha:s.sha},function(e,t){e||(n.path.push(s.path),n.stack.push(n.tree),n.file=t.value)})}}}}]),module.directive("diff",["$stateParams","$state","$HUB","$RPC","Reference","$filter",function(e,t,n,r,s,o){return{restrict:"E",templateUrl:"/directives/templates/diff.html",scope:{file:"=",issues:"=",baseSha:"=",headSha:"=",selection:"=",refIssues:"=",repo:"="},link:function(r){r.open=!r.file.ignored,r.expanded=!1,r.$watch("file.patch",function(t){t&&t.length&&!r.file.image&&n.wrap("gitdata","getBlob",{user:e.user,repo:e.repo,sha:r.file.sha},function(e,t){if(!e){for(var n=[],s=[],o=0;o<r.file.patch.length;)if(r.file.patch[o].chunk){for(var u=0,a=0,i=[];++o<r.file.patch.length&&!r.file.patch[o].chunk;)u=u?u:r.file.patch[o].head,a=r.file.patch[o].head?r.file.patch[o].head:a,i.push(r.file.patch[o]);s.push({start:u,end:a,chunk:i})}else o+=1;for(o=0;o<t.value.content.length;)if(s[0]&&t.value.content[o].head===s[0].start){var l=s.shift();n=n.concat(l.chunk),o=l.end}else n.push(t.value.content[o]),o+=1;r.file.file=n}})}),r.clear=function(){r.selection={}},r.selStarts=function(e){return s.starts(r.headSha,r.file.filename,e.head,r.selection.ref)},r.isSelected=function(e){return s.includes(r.headSha,r.file.filename,e.head,r.selection.ref)},r.refStarts=function(t){var n=!1;return r.issues&&o("filter")(r.issues,{number:e.issue}).forEach(function(e){n=n||s.starts(r.baseSha,r.file.filename,t.base,e.key)||s.starts(r.headSha,r.file.filename,t.head,e.key)}),n},r.generateAnchor=function(e){return e.head&&r.repo.permissions.push&&r.isReferenced(e)?r.headSha+"/"+r.file.filename+"L"+e.head:""},r.isReferenced=function(t){var n=!1;return r.issues&&o("filter")(r.issues,{number:e.issue}).forEach(function(e){n=n||s.includes(r.baseSha,r.file.filename,t.base,e.key)||s.includes(r.headSha,r.file.filename,t.head,e.key)}),n},r.select=function(e,t){if(e.head&&r.repo.permissions.push){var n=r.selection.start&&t.shiftKey&&r.file.filename===r.selection.path,o=n?r.selection.start:e.head,u=n?e.head:null;r.selection=s.select(r.headSha,r.file.filename,o,u)}},r.go=function(e){var n=[];return r.issues.forEach(function(t){(s.starts(r.baseSha,r.file.filename,e.base,t.key)||s.starts(r.headSha,r.file.filename,e.head,t.key))&&n.push(t.number)}),1===n.length?t.go("repo.pull.issue.detail",{issue:n[0]}):void(r.refIssues=n)}}}}]),module.directive("file",["$state","$filter","$stateParams","Reference",function(e,t,n,r){return{restrict:"E",templateUrl:"/directives/templates/file.html",scope:{path:"=",issues:"=",content:"=",headSha:"=",selection:"=",refIssues:"="},link:function(s){s.clear=function(){s.selection={}},s.selStarts=function(e){return r.starts(s.headSha,s.path,e.base,s.selection.ref)},s.isSelected=function(e){return r.includes(s.headSha,s.path,e.base,s.selection.ref)},s.refStarts=function(e){var o=!1;return s.issues&&t("filter")(s.issues,{number:n.issue}).forEach(function(t){o=o||r.starts(s.headSha,s.path,e.base,t.key)}),o},s.isReferenced=function(e){var o=!1;return s.issues&&t("filter")(s.issues,{number:n.issue}).forEach(function(t){o=o||r.includes(s.headSha,s.path,e.base,t.key)}),o},s.select=function(e,t){if(e.base){var n=s.selection.start&&t.shiftKey&&s.path===s.selection.path,o=n?s.selection.start:e.base,u=n?e.base:null;s.selection=r.select(s.headSha,s.path,o,u)}},s.go=function(t){var n=[];return s.issues.forEach(function(e){r.starts(s.headSha,s.path,t.base,e.key)&&n.push(e.number)}),1===n.length?e.go("repo.pull.issue.detail",{issue:n[0]}):void(s.refIssues=n)}}}}]),module.directive("focus",["$timeout",function(e){return{link:function(t,n,r){t.$watch(r.focus,function(s){s===!0&&e(function(){n[0].focus(),t[r.focus]=!1})})}}}]),module.directive("graph",function(){return{restrict:"E",templateUrl:"/directives/templates/graph.html",scope:{baseSha:"=",issueSha:"=",headSha:"=",activeSha:"=",openIssues:"=",compare:"&"},link:function(e){e.headCommitIssues=function(){if(e.openIssues)for(var t=0;t<e.openIssues.length;t++)if(e.openIssues[t].sha===e.headSha)return!0;return!1}}}}),module.directive("mergeButton",["$HUB","$stateParams","$timeout","$filter",function(e,t,n,r){return{restrict:"E",templateUrl:"/directives/templates/merge.html",scope:{permissions:"=",pull:"=",reposettings:"=",status:"="},link:function(s){var o={failure:"failed",pending:"pending",success:"succeeded"};s.permissions.push&&s.pull.base.repo.id===s.pull.head.repo.id&&e.call("gitdata","getReference",{user:t.user,repo:t.repo,ref:"heads/"+s.pull.head.ref},function(e){e||(s.branch=!0)}),s.$watch("status",function(e){var t=e?e.state:null;t&&(s.status.count=0,s.status.text=o[t],s.status.statuses.forEach(function(e){e.state===t&&s.status.count++,"failure"===e.state&&"errored"===e&&s.status.count++})),s.status=s.status||{state:"pending",statuses:[]}}),s.getStarText=function(){if(s.pull.stars&&s.reposettings.value){var e=s.pull.stars.length,t=s.reposettings.value.threshold;return t>e?r("pluralize")(t-e,"more ninja star")+" needed":r("pluralize")(e,"ninja star")}},s.deleteBranch=function(){s.showConfirmation=!1,e.call("gitdata","deleteReference",{user:t.user,repo:t.repo,ref:"heads/"+s.pull.head.ref},function(e){e||(s.branch=!1,s.branchRemoved=!0)})},s.merge=function(){s.merging=e.call("pullRequests","merge",{user:t.user,repo:t.repo,number:t.number})},s.confirm=function(){s.showConfirmation=!0,n(function(){s.showConfirmation=!1},1e4)}}}}]),module.directive("moment",["$timeout",function(e){return{restrict:"A",scope:{moment:"="},link:function(t,n,r){var s=r.display||"fromNow";t.$watch("moment",function(t){if(t){var r=function(){n.html(moment(t)[s]()),e(r,6e4)};r()}else n.html("")})}}}]),filters.filter("deep",function(){return function(e,t,n){if(null===n)return e;var r=[],s=t.split(".");return e=e instanceof Array?e:[],n="undefined"!=typeof n?n:!0,e.forEach(function(e){var t=e;try{s.forEach(function(e){t=t[e]})}catch(o){t=void 0}t===n&&r.push(e)}),r}}),filters.filter("in",function(){return function(e,t,n){if(!t||!t.length)return e;var r=[];return e.forEach(function(e){t.indexOf(e[n]||e)>-1&&r.push(e)}),r}}),filters.filter("pluralize",function(){return function(e,t,n){var r;return 1!==e&&(r=n?n:t+"s"),e+" "+(r||t)}}),module.factory("401HttpResponseInterceptor",["$q","$location",function(e,t){return{response:function(n){return 401===n.status?(window.location.href="/auth/github?next="+t.path(),e.reject(n)):n||e.when(n)},responseError:function(n){return 401===n.status?(window.location.href="/auth/github?next="+t.path(),e.reject(n)):e.reject(n)}}}]).config(["$httpProvider",function(e){e.interceptors.push("401HttpResponseInterceptor")}]),module.factory("404HttpResponseInterceptor",["$q","$location",function(e,t){return{responseError:function(n){return 404===n.status&&t.path("/error"),e.reject(n)}}}]).config(["$httpProvider",function(e){e.interceptors.push("404HttpResponseInterceptor")}]),module.controller("BadgeCtrl",["$scope","$modalInstance","$stateParams","$window",function(e,t,n,r){e.origin=r.location.origin,e.formats=[{id:0,title:"Image URL",link:e.origin+"/assets/images/wereviewninja-32.png"},{id:1,title:"Markdown",link:"[![ReviewNinja]("+e.origin+"/assets/images/wereviewninja-32.png)]("+e.origin+"/"+n.user+"/"+n.repo+")"},{id:2,title:"Textile",link:"!"+e.origin+"/assets/images/wereviewninja-32.png:"+e.origin+"/"+n.user+"/"+n.repo},{id:3,title:"RDoc",link:'{<img src="'+e.origin+"/assets/images/wereviewninja-32.png\" alt='ReviewNinja' />}["+e.origin+"/"+n.user+"/"+n.repo+"]"},{id:4,title:"Asciidoc",link:"image:"+e.origin+"/assets/images/wereviewninja-32.png['ReviewNinja', link=\""+e.origin+"/"+n.user+"/"+n.repo+'"]'},{id:5,title:"RST",link:".. image::"+e.origin+"/assets/images/wereviewninja-32.png\n:target: "+e.origin+"/"+n.user+"/"+n.repo},{id:6,title:"Pod",link:'=for HTML <a href="'+e.origin+"/"+n.user+"/"+n.repo+'"><img src="'+e.origin+'/assets/images/wereviewninja-32.png"></a>'}],e.update=function(){this.formatText=this.formats[this.selectedFormat].link},e.ok=function(){t.dismiss()}}]),angular.module("ninja.config",[]).provider("$config",function(){function e(e){this.get=function(t){e.get("/config").success(function(e,n){t(e||{},n)})}}this.$get=["$http",function(t){return new e(t)}];var t=$.url();this.log="true"===t.param("log")||"localhost"===document.location.hostname}),module.factory("Comment",["$HUB","$stateParams",function(e,t){return{render:function(n){return n.body&&e.wrap("markdown","render",{text:n.body,mode:"gfm",context:t.user+"/"+t.repo},function(e,t){e||(n.html=t.value.body)}),n}}}]),module.factory("File",["$HUB","$stateParams",function(){var e=["jpg","jpeg","png","bmp","psd","tiff","ico"],t=function(t){var n=t.split(".").pop().toLowerCase();return-1!==e.indexOf(n)?!0:!1};return{getTreeTypes:function(e){return e.tree.forEach(function(e){"blob"===e.type&&t(e.path)&&(e.type="image")}),e},getFileTypes:function(e){return e.forEach(function(e){t(e.filename)&&(e.image=e.raw_url)}),e}}}]),module.factory("Issue",["$stateParams","$HUB",function(e,t){var n=/\|commit\|file reference\|.*\r\n\|-+\|-+\|.*\r\n\|(\b[0-9a-f]{40}\b)\|(\[([^\|]*)?\].*?|[`]none[`])\|.*/;return{parse:function(e){var t=n.exec(e.body);return t&&(e.sha=t[1],e.ref=t[3],e.body=e.body.replace(t[0],"").trim(),e.sha&&e.ref&&(e.key=e.sha+"/"+e.ref)),e},render:function(n){return n.body&&t.wrap("markdown","render",{text:n.body,mode:"gfm",context:e.user+"/"+e.repo},function(e,t){e||(n.html=t.value.body)}),n}}}]),module.factory("Pull",["$HUB","$RPC","$stateParams","$rootScope",function(e,t,n,r){return{milestone:function(t){return t.milestone&&e.call("issues","getMilestone",{user:t.base.repo.owner.login,repo:t.base.repo.name,number:t.milestone.number},function(e,n){e||t.milestone.id!==n.value.id||(t.milestone=n.value)}),t},render:function(t){return t.body&&e.wrap("markdown","render",{text:t.body,mode:"gfm",context:n.user+"/"+n.repo},function(e,n){e||(t.html=n.value.body)}),t},stars:function(n,s){return t.call("star","all",{sha:n.head.sha,repo_uuid:n.base.repo.id},function(t,o){t||(n.star=null,n.stars=o.value,n.stars.forEach(function(t){t.name===r.user.value.login&&(n.star=t),s&&(t.user=e.call("user","getFrom",{user:t.name}))}))}),n},commentsCount:function(t){return e.call("issues","getComments",{user:n.user,repo:n.repo,number:t.number,per_page:10},function(e,n){e||(t.commentsCount=n.value.length<10?n.value.length:n.value.length+"+")}),t}}}]),module.factory("Reference",["$stateParams",function(){var e=/([0-9a-f]{40})\/([^#]+)#L([0-9]+)-?L?([0-9]+)?/,t=function(e,t,n,r){return e+"/"+t+"#L"+n+(r&&r!==n?"-L"+r:"")},n=function(e,t,n){return e>=t&&n>=e};return{get:function(e,n,r,s){return t(e,n,r,s)},select:function(e,n,r,s){return s&&r>s&&(s=[r,r=s][0]),{sha:e,path:n,start:r,end:s,ref:t(e,n,r,s)}},starts:function(t,n,r,s){var o,u,a,i=e.exec(s);return i&&(o=i[1],u=i[2],a=parseInt(i[3],10)),o===t&&u===n&&a===r},includes:function(t,r,s,o){var u,a,i,l,c=e.exec(o);return c&&(u=c[1],a=c[2],i=parseInt(c[3],10),l=parseInt(c[4],10)),u===t&&a===r&&(i===s||n(s,i,l))}}}]),module.factory("socket",["$rootScope",function(e){var t=io.connect();return{on:function(n,r){t.on(n,function(){var n=arguments;e.$apply(function(){r.apply(t,n)})})},emit:function(n,r,s){t.emit(n,r,function(){var n=arguments;e.$apply(function(){s&&s.apply(t,n)})})}}}]),module.controller("IssueDetailCtrl",["$rootScope","$scope","$state","$stateParams","$location","$anchorScroll","$HUB","$RPC","Issue","Comment","repo","issue","socket",function(e,t,n,r,s,o,u,a,i,l,c,p,f){t.repo=c.value,t.issue=i.parse(p.value)&&i.render(p.value),t.compComm(t.issue.sha),t.$parent.$parent.sha=t.issue.sha,t.comments=u.call("issues","getComments",{user:r.user,repo:r.repo,number:r.issue},function(e,t){e||t.affix.forEach(function(e){e=l.render(e)})}),t.scrollIssueLine=function(){var e=t.issue.ref.replace(/#/g,"");e.indexOf("-")>-1&&(e=e.replace(/(\-[^-]*$)/,""));var n=t.issue.sha+"/"+e;s.hash(n),o()},t.setState=function(){t.addComment();var e="open"===t.issue.state?"closed":"open";t.set=u.call("issues","edit",{user:r.user,repo:r.repo,number:t.issue.number,state:e})},t.addComment=function(){t.comment&&(t.commenting=u.wrap("issues","createComment",{user:r.user,repo:r.repo,number:r.issue,body:t.comment},function(e){e||(t.comment=null)}))},t.statustext=function(){return"open"===t.issue.state?t.comment?"Close and comment":"Close issue":t.comment?"Reopen and comment":"Reopen issue"},f.on(r.user+":"+r.repo+":issue_comment",function(e){t.issue.number===e.number&&"created"===e.action&&u.call("issues","getComment",{user:r.user,repo:r.repo,id:e.id},function(e,n){e||t.comments.value.push(l.render(n.value))})}),f.on(r.user+":"+r.repo+":issues",function(e){t.issue.number===e.number&&u.call("issues","getRepoIssue",{user:r.user,repo:r.repo,number:r.issue},function(e,n){e||(t.issue=i.parse(n.value)&&i.render(n.value))})})}]),module.controller("IssueListCtrl",["$scope","$stateParams",function(e){e.compComm(e.pull.base.sha),e.$parent.$parent.sha=null}]);