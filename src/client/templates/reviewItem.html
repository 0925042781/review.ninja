<table class="table" style="table-layout:fixed; margin-bottom:0px;">
  <tr class="no-select">
    <td style="padding-right:0px; width:35px;">
        <a class="text-primary" ui-sref="repo.pull.review.reviewList()"><i class="fa fa-lg fa-angle-left"></i></a>
    </td>
    <td>
        <h4 class="panel-title">
            <strong>{{ $stateParams.sha.substring(0,8) }} / {{ $stateParams.ref }}</strong> 
        </h4>
        <p ng-if="!(review.thread[$stateParams.sha][$stateParams.ref].comments.length > 0)" style="padding-top:15px">Starting a new thread to review {{ $stateParams.sha.substring(0,8) }} / {{ $stateParams.ref }}</p>
        <p ng-if="review.thread[$stateParams.sha][$stateParams.ref].comments.length > 0" style="padding-top:15px">{{ review.thread[$stateParams.sha][$stateParams.ref].comments[review.thread[$stateParams.sha][$stateParams.ref].comments.length-1].user.login }} last commented on this thread <span moment="review.thread[$stateParams.sha][$stateParams.ref].comments[review.thread[$stateParams.sha][$stateParams.ref].comments.length-1].created_at"></span></p>
    </td>
    <td class="text-center text-primary" style="width:50px; padding-left:0;">
      <i class="octicon octicon-comment"></i>
      {{ review.thread[$stateParams.sha][$stateParams.ref].comments.length }}
    </td>
  </tr>
</table>

<div style="padding:20px 10px; margin-bottom:20px;">
  <table style="width:100%;">
    <tr ng-repeat="(thread, comment) in review.thread[$stateParams.sha][$stateParams.ref].comments" ng-show="comment.html">
      <td style="width:42px; padding-right:10px; vertical-align:top;">
        <img ng-show="comment.user" ng-src="{{ comment.user ? comment.user.avatar_url + '&s=42' : '/assets/images/user_deleted.jpg'}}" width="42px" />
      </td>
      <td>
        <div class="panel panel-default comment">
          <div class="panel-heading">
            <div class="panel-arrow"></div>
            <strong>{{ comment.user.login }}</strong> commented <span moment="comment.created_at"></span>
          </div>
          <div class="panel-body" ng-bind-html="comment.html"></div>
        </div>
      </td>
    </tr>
  </table>

  <i class="fa fa-2x fa-spinner fa-spin center-block" ng-show="review.loading"></i>

  <form role="form" ng-submit="addReviewComment($stateParams)">
    <table style="width:100%" ng-show="!review.loading && !review.hasMore">
      <tr>
        <td style="width:42px; padding-right:10px; vertical-align:top;">
          <img ng-src="{{ user.value.avatar_url }}&s=42" width="42px" />
        </td>
        <td>
          <div class="panel panel-default comment">
            <div class="panel-heading">
              <div class="panel-arrow"></div>
              <strong>{{ user.value.login }}</strong>
            </div>
            <div class="panel-body" style="padding:0;">
              <textarea class="form-control" ng-model="$parent.$parent.$parent.reviewComment" rows="4" placeholder="Leave line note comment"></textarea>
            </div>
          </div>

          <div class="pull-right">
            <div class="btn-group dropup">
              <button class="btn btn-default dropdown-toggle"
                      type="button" 
                      data-toggle="dropdown" 
                      aria-haspopup="true" 
                      aria-expanded="true">
                Add status <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" role="menu">
                <li>
                  <a href="" ng-click="$parent.$parent.$parent.reviewComment.concat('!fix')">!fix</a>
                </li>
                <li>
                  <a href="" ng-click="$parent.$parent.$parent.reviewComment.concat('!resolve')">!resolve</a>
                </li>
                <li>
                  <a href="" ng-click="$parent.$parent.$parent.reviewComment.concat('!fixed')">!fixed</a>
                </li>
                <li>
                  <a href="" ng-click="$parent.$parent.$parent.reviewComment.concat('!resolved')">!resolved</a>
                </li>
                <li>
                  <a href="" ng-click="$parent.$parent.$parent.reviewComment.concat('!completed')">!completed</a>
                </li>
              </ul>
            </div>
            <button type="submit" class="btn btn-primary"  ng-disabled="!$parent.$parent.$parent.reviewComment">Comment</button>
          </div>

          <div style="clear:both;"></div>
        </td>
      </tr>
    </table>
  </form>
</div>
