<tabset>
  <tab>
    <tab-heading>Review Status</tab-heading>

    <table class="table table-hover"
           ng-repeat="(key, val) in review.thread">
      <tr class="select"
          ng-repeat="(key, val) in val"
          ui-sref="repo.pull.review.reviewItem({
              base: pull.head.sha !== $parent.key ? $parent.key : pull.base.sha, 
              sha: $parent.key, 
              ref: key
            })">
        <td style="width:40px; padding-right:0;">
          <img ng-src="{{ val.comments[0].user.avatar_url }}&s=42" width="42px" />
        </td>
        <td>
          <div>
            <strong>{{ val.comments[0].user.login }}</strong> started a review thread on commit <a> {{ $parent.key.substring(0,8) }} : {{ key }} </a>
          </div>
            <small>
            Last updated <span moment="val.comments[val.comments.length-1].created_at"></span> &nbsp;
            </small>
          <div style="padding-top:5px">
            <div class="dropdown" dropdown is-open="dropdownIsOpen" ng-click="$event.stopPropagation(); dropdownIsOpen=!dropdownIsOpen">
              <button class="btn btn-sm dropdown-toggle" ng-class="{'btn-warning': (val.status === 'open'), 'btn-success': (val.status === 'closed')}" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                {{ val.status }}
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                <li ng-click="addCommentFromDropdown('!fix', {sha: $parent.key, ref: key})"><a>open</a></li>
                <li ng-click="addCommentFromDropdown('!fixed', {sha: $parent.key, ref: key})"><a>closed</a></li>
              </ul>
            </div>
          </div>
        </td>
        <td class="text-center text-primary" style="width:50px; padding-left:0;">
          <i class="octicon octicon-comment"></i>
          {{ val.comments.length }}
        </td>
      </tr>
    </table>

    <i class="fa fa-2x fa-spinner fa-spin center-block" ng-show="review.loading"></i>

  </tab>
  
  <tab>
    <tab-heading>Pull Request Conversation</tab-heading>
    <div style="padding:20px 10px; margin-bottom:20px;">
      <table style="width:100%;">
        <tr ng-repeat="comment in conversation.value" ng-show="comment.html">
          <td style="width:42px; padding-right:10px; vertical-align:top;">
            <img ng-show="comment.user" ng-src="{{ comment.user ? comment.user.avatar_url + '&s=42' : '/assets/images/user_deleted.jpg'}}" width="42px" />
          </td>
          <td>
            <div class="panel panel-default comment">
              <div class="panel-heading">
                <div class="panel-arrow"></div>
                <strong>{{ comment.user.login }}</strong> commented <span moment="comment.created_at"></span>
              </div>
              <div class="panel-body" ng-bind-html="comment.html"></div>
            </div>
          </td>
        </tr>
      </table>

      <i class="fa fa-2x fa-spinner fa-spin center-block" ng-show="conversation.loading"></i>

      <form role="form" ng-submit="addComment()">
        <table style="width:100%" ng-show="!conversation.loading && !conversation.hasMore">
          <tr>
            <td style="width:42px; padding-right:10px; vertical-align:top;">
              <img ng-src="{{ user.value.avatar_url }}&s=42" width="42px" />
            </td>
            <td>
              <div class="panel panel-default comment">
                <div class="panel-heading">
                  <div class="panel-arrow"></div>
                  <strong>{{ user.value.login }}</strong>
                </div>
                <div class="panel-body" style="padding:0;">
                  <textarea class="form-control" ng-model="$parent.$parent.$parent.$parent.comment" rows="4" placeholder="Leave a pull request comment"></textarea>
                </div>
              </div>

              <div class="pull-right">
                <i class="fa fa-lg fa-spinner fa-spin" ng-show="commenting.loading" style="margin-right:10px;"></i>
                <button type="submit" class="btn btn-primary"  ng-disabled="!$parent.$parent.$parent.$parent.comment">Comment</button>
              </div>
              <div style="clear:both;"></div>
            </td>
          </tr>
        </table>
      </form>
    </div>
  </tab>
</tabset>
