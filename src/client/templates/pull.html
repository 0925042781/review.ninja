<div class="row">
  <div class="col-md-9">

    <p class="lead"><a ui-sref="repo.list({ user:repo.value.owner.login, repo:repo.value.name })">{{ repo.value.full_name }}</a></p>

    <div class="well row" style="margin: 0px 0px 20px 0px;">
      <div class="col-md-9">
        <h5>
          <button class="btn btn-primary" tooltip-placement="bottom" tooltip-html-unsafe="{{ stargazers.value | stargazerAccumulator }}" ng-click="{true: unstar, false: star}[starred]()"><i class="fa fa-star"></i> {{ {true: 'Unstar', false: 'Star'}[starred] }} ({{ stargazers.value.length }})</button>
          <span>
            <span class="label pull-right" ng-class="{'label-default':status.value==='pending', 'label-success':status.value==='approved', 'label-danger':status.value==='rejected'}">
              {{ status.value }}
            </span>

            {{ pull.value.title }}
            <span>
              <img class="img-circle" ng-src="{{ pull.value.user.avatar_url }}" width="18px" />
              {{ pull.value.user.login }} <small moment="pull.value.created_at"></small>
              <!-- <img ng-src="/badge/{{ repo.value.owner.login }}/{{ repo.value.name }}/{{ pull.value.head.sha }}"> -->
            </span>
          </span>
        </h5>
      </div>
      <div class="col-md-3">
        <h5>
          <button type="button" ng-show="!pull.value.merged" class="btn btn-primary btn-block" ng-click="merge()" popover="{{ {true: 'If it has passed review, you can now merge!', false: 'We strongly encourage to only merge once it\'s passed code review.'}[stargazers.value.length>0] }}" popover-trigger="mouseenter" popover-placement="left" popover-title="{{ {true: 'Can be automatically merged!', false: 'Cannot be automatically merged!'}[pull.value.mergeable] }}"> 
            Merge pull request
          </button>
          <small ng-show="pull.value.merged">This pull request was merged by {{ pull.value.merged_by.login }} <span moment="pull.value.merged_at"></small>
        </h5>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        <tabset>
        <tab heading="Diff">
        <div ng-repeat="file in files.value" class="panel panel-default" style="margin:20px;">
          <div class="panel-heading">
            <strong>
              {{ file.filename }}
            </strong>
          </div>
          <div class="panel-body" ng-show="file.status=='renamed'">
            This file was renamed.
          </div>
          <div class="panel-body" ng-show="file.status=='modified' || file.status=='added' || file.status=='removed'" style="padding:0;">
            <diff lines="file.lines.lines"></diff>
          </div>
        </div>
        </tab>
        <tab heading="Files">
        <browser data="tree"></browser>
        </tab>
        </tabset>
      </div>
    </div>
  </div>
  <div class="col-md-3 sidebar">
    <button class="btn btn-danger btn-block" ng-click="showNewIssue=!showNewIssue">Create Issue</button>
    <div class="new-issue" ng-show="showNewIssue" ng-init="showNewIssue=false">
      <h5>New Issue</h5>
      <div class="form-group">
        <input ng-model="newIssue.title" ng-init="newIssue.title=''" class="form-control" placeholder="Issue title" />
      </div>
      <div class="form-group">
        <textarea ng-model="newIssue.body" ng-init="newIssue.body=''" class="form-control" placeholder="Issue body..." />
      </div>
      <div class="form-group">
        <button class="form-control btn btn-default" ng-click="createNewIssue()">CREATE</button>
      </div>
    </div>
    <ul class="nav">
      <li class="issue" ng-show="currentIssue != null">
        <a ng-click="setCurrentIssue(currentIssue)">
          <span class="fa-stack">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-bars fa-stack-1x fa-inverse"></i>
          </span>
          <span> Back to all issues</span>
        </a></li>
      <li class="issue" ng-repeat="issue in issue.value" ng-show="currentIssue == null || currentIssue == issue">
        <a ng-click="setCurrentIssue(issue)">
          <span class="fa-stack closed-issue" ng-show="issue.state == 'closed'">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-check fa-stack-1x fa-inverse"></i>
          </span>
          <span class="fa-stack open-issue" ng-show="issue.state == 'open'">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-exclamation fa-stack-1x fa-inverse"></i>
          </span>
          <span> {{ issue.title }}</span>
        </a>
        <div ng-show="currentIssue === issue">
          <p class="well">
            {{ currentIssue.body }}
          </p>
          <p ng-repeat="comment in currentIssue.comments.value" class="well">
            {{ comment.body }}
          </p>
          <div class="form-group">
            <textarea class="form-control" placeholder="Comment body..." ng-model="$parent.newCommentBody" ng-class="issue-{{issue.number}}" ng-init="newCommentBody=''"></textarea>
          </div>
          <div class="form-group">
            <button class="btn btn-default btn-block" ng-click="comment(newCommentBody)">Comment</button>
          </div>
        </div>
      </li>
    </ul>
  </div>
</div>
